---
title: "Final Assignment: Roman Emperors"
author: "Rebeka Zsoldos"
output: html_document
editor_options:
  chunk_output_type: console
---
## Background,

The Roman Emperors ruled the Roman Empire from 27 BC till 395 AC.

```{r setup, include=FALSE}
library(dplyr)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(viridis)

theme_set(theme_light())
```

## Importing Data

```{r}
emperors_raw <- readr::read_csv(url("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-08-13/emperors.csv"), na = c("NA", "Unknown"))

```

## Cleaning Data


``` {r}
emperors_raw <- emperors_raw %>%
  mutate(
    birth_cty = as.factor(birth_cty),
    birth_prv = as.factor(birth_prv),
    rise = fct_relevel(rise, 
                            "Seized Power", "Appointment by Army", "Appointment by Praetorian Guard", "Purchase",
                            "Election", "Appointment by Senate", "Appointment by Emperor", "Birthright"),
    cause = fct_relevel(cause, 
                             "Natural Causes", "Assassination", "Execution",  "Suicide", "Died in Battle",
                              "Captivity"),
    killer = as.factor(killer),
    dynasty = as.factor(dynasty),
    era = as.factor(era)
           ) %>%
  select(-name_full, -notes, - verif_who)

emperors <- emperors_raw %>%
  mutate(
    birth_y = as.numeric(format(birth, '%Y')),
    death_y = as.numeric(format(death, '%Y')),
    reign_start_y = as.numeric(format(reign_start, '%Y')),
    reign_end_y = as.numeric(format(reign_end, '%Y'))) %>%
  mutate(
    birth_y = ifelse(birth_y > death_y, (birth_y * -1), (birth_y * 1)),
    reign_start_y = ifelse(reign_start_y > reign_end_y, (reign_start_y * -1), (reign_start_y * 1)),
    age_reign_start = reign_start_y - birth_y,
    age_reign_end = reign_end_y - birth_y,
    reign_long_y = reign_end_y - reign_start_y)
```


## The emperors

The emperors rised to and fall out of power by many reasons, so I investigate the causes how they followed each other.

``` {r}

rise_emperors <- emperors %>%
  ggplot(aes(reign_start_y, rise, color = dynasty, shape = era)) +
  geom_point(alpha = 0.5) +
  scale_x_continuous(breaks = c(-26, 305, 395),
                   labels = c("26 B.C.", "305 A.D.", "395 A.D.")) +
  xlab("The year when their ruling started") +
  ylab("The cause to rising to power") +
  labs(title = "The Rise of Emperors") +
  scale_color_viridis_d()

fall_emperors <- emperors %>%
  ggplot(aes(reign_end_y, cause, color = dynasty, shape = era)) +
  geom_point(alpha = 0.5) +
  scale_x_continuous(breaks = c(14, 305, 395),
                   labels = c("14 A.D.", "305 A.D.", "395 A.D.")) +
  xlab("The year when their ruling ended") +
  ylab("The cause to fall out of power") +
  labs(title = "The Fall of Emperors") +
  scale_color_viridis_d()


rise_emperors

fall_emperors

rise_and_fall <- emperors %>%
  count(rise, cause)

rise_and_fall2 <- emperors %>%
  ggplot(aes(rise, fill = cause)) +
  geom_bar(width = 0.3) +
  coord_flip() +
  theme(legend.position = "bottom") +
  xlab("The rise of the emperors") +
  ylab(NULL) +
  labs(title = "The Rise and Fall of the Roman Emperors") +
  scale_fill_viridis(discrete = TRUE, na.value = "grey", name = "The cause of death")

print.data.frame(rise_and_fall)
rise_and_fall2

```


## The duration of the reign

The age of emperors and the duration of the raign varied. So I take a look at how they relate to each other. 

``` {r}
age_and_long <- emperors %>%
  ggplot(aes(age_reign_start, reign_long_y)) +
  geom_point() +
  geom_smooth() +
  theme_light() +
  theme(legend.position = "bottom", legend.title = element_blank()) +
  xlab("The age of the emperor when rising to power") +
  ylab("Duration of the reign") +
  scale_color_viridis(discrete = TRUE, na.value = "grey")

death_and_long <- emperors %>%
  ggplot(aes(age_reign_end, reign_long_y)) +
  geom_point() +
  geom_smooth() +
  theme_light() +
  theme(legend.position = "bottom", legend.title = element_blank()) +
  xlab("The age of the emperor when his reing ended") +
  ylab("Duration of the reign") +
  scale_color_viridis(discrete = TRUE, na.value = "grey")

age_and_long
death_and_long
```

## The death of emperors

The emperors reign ended by many cause and many killers

``` {r}


death_types <- emperors %>%
  count(cause, killer)

died_by <- emperors %>%
  filter(cause != "NA") %>%
  ggplot(aes(cause, fill = killer)) +
  geom_bar(width = 0.3) +
  coord_flip() +
  theme_light() +
  theme(legend.position = "bottom", legend.title = element_blank()) +
  xlab(NULL) +
  ylab(NULL) +
  labs(title = "The Cause of Death Among the Roman Emperors") +
  scale_fill_viridis(discrete = TRUE, na.value = "grey")

print.data.frame(death_types)
died_by

```

## Recoding the data and prepare for the preictive models

Filter the data for the Principate era only as in the Dominate era there were 4 rulers at once
Recode the variable Cause:
-- Make one category form Captivity and Died in Battle: Battle
-- Make one category from Assassination, Suicide, Execution as the Killers are similar related to these categories: Forced
Recode the variable Killers
-- Make one category from Aneurism, Heart Failure: Health
-- Make one category from Lightning, Fire: Natural disaster
Remove datas with missing variable


```{r}
emperors_rise <- emperors %>%
  filter(rise == "Purchase" | rise == "Election") %>%
  select(index, name, era)

emperors_principate <- emperors %>%
  filter(era == "Principate") %>%
  select(-birth, -death, -birth_cty, -birth_prv, -reign_start, -reign_end, -era) %>%
  mutate(
    cause_recoded = recode(cause, "Died in Battle" = "Battle", "Captivity" = "Battle", "Assassination" = "Forced", "Suicide" = "Forced", "Execution" = "Forced"),
    killer_recoded = recode(killer, "Aneurism" = "Health", "Heart Failure" = "Health", "Disease" = "Health", "Lightning" = "Natural Phenomenon", "Fire" = "Natural Phenomenon", "Wife" = "Other Opponents", "Court Officials" = "Other Opponents", "Usurper" = "Other Opponents"),
    died_by_force = recode(cause_recoded, "Forced" = 1, "Battle" = 0, "Natural Causes" = 0),
    died_by_battle = recode(cause_recoded, "Forced" = 0, "Battle" = 1, "Natural Causes" = 0),
    died_naturally = recode(cause_recoded, "Forced" = 0, "Battle" = 0, "Natural Causes" = 1)
    ) %>%
  slice(-c(20)) %>%
  select(-cause, -killer, - birth_y, -death_y, index, name, rise, cause_recoded, killer_recoded, everything()) %>%
  drop_na(cause_recoded)
```



## Probabilities of dying by force, battle, or natural causes

Kérdések: ha egy bizonyos idő eltelik, akkor el teszik-e az uralkodót láb alól?
mi a predikciója az erővel való meghalásnak

``` {r}
#emperors_recoded_forced <- emperors_recoded %>%
  #filter(cause = "Forced")

#model2 <- glm(killer  ~ rise + reign_long_y + age_reign_start + era + dynasty, data = emperors_recoded, family = "gaussian")

```

## Predicting to be fall by force, battle, or natural causes

## Predicting the killer when falling by force

