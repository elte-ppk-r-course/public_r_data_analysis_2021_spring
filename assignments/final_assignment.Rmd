---
title: "Final Assignment: Roman Emperors"
author: "Rebeka Zsoldos"
output: html_document
editor_options:
  chunk_output_type: console
---
## Background,

The Roman Emperors ruled the Roman Empire from 27 BC till 395 AC.

```{r setup, include=FALSE}
library(dplyr)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(viridis)

theme_set(theme_light())
```

## Importing Data

```{r}
emperors_raw <- readr::read_csv(url("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-08-13/emperors.csv"), na = c("NA", "Unknown"))

```

## Cleaning Data


``` {r}
emperors_raw <- emperors_raw %>%
  mutate(
    birth_cty = as.factor(birth_cty),
    birth_prv = as.factor(birth_prv),
    rise = fct_relevel(rise, 
                            "Seized Power", "Appointment by Army", "Appointment by Praetorian Guard", "Purchase",
                            "Election", "Appointment by Senate", "Appointment by Emperor", "Birthright"),
    cause = fct_relevel(cause, 
                             "Natural Causes", "Assassination", "Execution",  "Suicide", "Died in Battle",
                              "Captivity"),
    killer = as.factor(killer),
    dynasty = as.factor(dynasty),
    era = as.factor(era)
           ) %>%
  select(-name_full, -notes, - verif_who)

emperors <- emperors_raw %>%
  mutate(
    birth_year = as.numeric(format(birth, '%Y')),
    death_year = as.numeric(format(death, '%Y')),
    reign_start_year = as.numeric(format(reign_start, '%Y')),
    reign_end_year = as.numeric(format(reign_end, '%Y'))) %>%
  mutate(
    birth_year = ifelse(birth_year > death_year, (birth_year * -1), (birth_year * 1)),
    reign_start_year = ifelse(reign_start_year > reign_end_year, (reign_start_year * -1), (reign_start_year * 1)),
    age_reign_start = reign_start_year - birth_year,
    age_reign_end = reign_end_year - birth_year,
    reign_long_year = reign_end_year - reign_start_year,
    reign_long_cat = cut(reign_long_year, breaks = c(-Inf, 1, 10, 20, Inf), labels = c("0 - 1 year", "2 - 10 years", "10 - 20 years", "20 years or more")),
    century = reign_end_year %/% 100 + 1)
```


## The emperors

The emperors rised to and fall out of power by many reasons, so I investigate the causes how they followed each other.

``` {r}

rise_emperors <- ggplot(emperors, aes(reign_start_year, rise, color = dynasty, shape = era)) +
  geom_point(alpha = 0.5) +
  scale_x_continuous(breaks = c(-26, 305, 395),
                   labels = c("26 B.C.", "305 A.D.", "395 A.D.")) +
  xlab("The year when their ruling started") +
  ylab("The cause to rising to power") +
  labs(title = "The Rise of Emperors") +
  scale_color_viridis_d()
  

fall_emperors <- emperors %>%
  ggplot(aes(reign_end_year, cause, color = dynasty, shape = era)) +
  geom_point(alpha = 0.5) +
  scale_x_continuous(breaks = c(14, 305, 395),
                   labels = c("14 A.D.", "305 A.D.", "395 A.D.")) +
  xlab("The year when their ruling ended") +
  ylab("The cause to fall out of power") +
  labs(title = "The Fall of Emperors") +
  scale_color_viridis_d()


rise_emperors

fall_emperors

rise_and_fall <- emperors %>%
  count(rise, cause) %>%
  view()

rise_and_fall2 <- emperors %>%
  ggplot(aes(rise, fill = cause)) +
  geom_bar(width = 0.3) +
  coord_flip() +
  theme(legend.position = "bottom") +
  xlab("The rise of the emperors") +
  ylab(NULL) +
  labs(title = "The Rise and Fall of the Roman Emperors") +
  scale_fill_viridis(discrete = TRUE, na.value = "grey", name = "The cause of death")

rise_and_fall2

death_types <- emperors %>%
  count(cause, killer) %>%
  view()

fall_and_rule <- emperors %>%
  ggplot(aes(reign_long_cat, fill = cause)) +
  geom_bar(width = 0.3) +
  coord_flip() +
  theme(legend.position = "bottom") +
  xlab("The ruling time of the emperors") +
  ylab(NULL) +
  labs(title = "The Fall of the Roman Emperors") +
  scale_fill_viridis(discrete = TRUE, na.value = "grey", name = "The cause of death")

fall_and_rule


died_by <- emperors %>%
  ggplot(aes(fct_rev(cause), fill = killer)) +
  geom_bar(width = 0.3) +
  coord_flip() +
  theme_light() +
  theme(legend.position = "bottom", legend.title = element_blank()) +
  xlab(NULL) +
  ylab(NULL) +
  labs(title = "The Cause of Death Among the Roman Emperors") +
  scale_fill_viridis(discrete = TRUE, na.value = "grey")


died_by

```


## The duration of the reign

The age of emperors and the duration of the raign varied. So I take a look at how they relate to each other. 

``` {r}
age_and_long <- emperors %>%
  ggplot(aes(age_reign_start, reign_long_year)) +
  geom_point(alpha = 0.2, color = "red") +
  geom_text(aes(label = name), size= 3, check_overlap = TRUE) +
  geom_smooth(se = FALSE) +
  theme_light() +
  theme(legend.position = "bottom", legend.title = element_blank()) +
  xlab("The age of the emperor when rising to power") +
  ylab("Duration of the reign") +
  scale_color_viridis(discrete = TRUE, na.value = "grey")

death_and_long <- emperors %>%
  ggplot(aes(age_reign_end, reign_long_year)) +
  geom_point(alpha = 0.2, color = "red") +
  geom_text(aes(label = name), size= 3, check_overlap = TRUE) +
  geom_smooth(se = FALSE) +
  theme_light() +
  theme(legend.position = "bottom", legend.title = element_blank()) +
  xlab("The age of the emperor when his reing ended") +
  ylab("Duration of the reign") +
  scale_color_viridis(discrete = TRUE, na.value = "grey")

age_and_long
death_and_long
```


## Recoding the data and prepare it for the predictive models

Filtering the data for the Principate era only as in the Dominate era there were 4 rulers at once
Recoding the variable Cause:
-- Making one category form Captivity and Died in Battle: Battle
-- Making one category from Assassination, Suicide, Execution: Forced
Recoding the variable Killers
-- Making one category from Aneurism and Heart Failure: Health
-- Making one category from Lightning, Fire: Natural disaster
Removing missing datas in the variable Cause
Removing the emperors rising by Purchase or Election??


```{r}
emperors %>%
  filter(rise == "Purchase" | rise == "Election") %>%
  select(index, name, era) %y%
  view()

emperors %>%
  group_by(rise) %>%
  count(killer) %>%
  view()

emperors_principate <- emperors %>%
  filter(era == "Principate") %>%
  select(-birth, -death, -birth_cty, -birth_prv, -reign_start, -reign_end, -era) %>%
  mutate(
    cause_recoded = recode(cause, "Died in Battle" = "Battle", "Captivity" = "Battle", "Assassination" = "Forced", "Suicide" = "Forced", "Execution" = "Forced"),
    killer_recoded = recode(killer, "Aneurism" = "Health", "Heart Failure" = "Health", "Disease" = "Health", "Lightning" = "Natural Phenomenon", "Fire" = "Natural Phenomenon", "Wife" = "Other Opponents", "Court Officials" = "Other Opponents", "Usurper" = "Other Opponents"),
    died_by_force = recode(cause_recoded, "Forced" = 1, "Battle" = 0, "Natural Causes" = 0),
    died_by_battle = recode(cause_recoded, "Forced" = 0, "Battle" = 1, "Natural Causes" = 0),
    died_naturally = recode(cause_recoded, "Forced" = 0, "Battle" = 0, "Natural Causes" = 1)
    ) %>%
  select(index, name, rise, cause_recoded, killer_recoded, everything(), -cause, -killer, - birth_year, -death_year)

rise_and_fall_principate <- emperors_principate %>%
  ggplot(aes(rise, fill = cause_recoded)) +
  geom_bar(width = 0.3) +
  coord_flip() +
  theme(legend.position = "bottom") +
  xlab("The rise of the emperors") +
  ylab(NULL) +
  labs(title = "The Rise and Fall of the Roman Emperors in the Principate") +
  scale_fill_viridis(discrete = TRUE, na.value = "grey", name = "The cause of death")


rise_and_fall_principate

rise_and_fall_principate2 <- emperors_principate %>%
  ggplot(aes(rise, fill = killer_recoded)) +
  geom_bar(width = 0.3) +
  coord_flip() +
  theme(legend.position = "bottom") +
  xlab("The rise of the emperors") +
  ylab(NULL) +
  labs(title = "The Rise and Death of the Roman Emperors in the Principate") +
  scale_fill_viridis(discrete = TRUE, na.value = "grey", name = "The killers")

rise_and_fall_principate2

fall_and_rule_principate <- emperors_principate %>%
  ggplot(aes(reign_long_cat, fill = cause_recoded)) +
  geom_bar(width = 0.3) +
  coord_flip() +
  theme(legend.position = "bottom") +
  xlab("The ruling time of the emperors") +
  ylab(NULL) +
  labs(title = "The Fall of the Roman Emperors") +
  scale_fill_viridis(discrete = TRUE, na.value = "grey", name = "The cause of death")

fall_and_rule_principate
```



## Probabilities of dying by force, battle, or natural causes

Kérdések: ha egy bizonyos idő eltelik, akkor el teszik-e az uralkodót láb alól?
mi a predikciója az erővel való meghalásnak

``` {r}
emperors_principate %>%
  count(cause_recoded) %>%
  view()

model_forced <- glm(died_by_force ~ rise + century + age_reign_start + reign_long_cat, family = "binomial")

summary(model_forced)

ggplot(emperors_principate, aes(reign_long_year, died_by_force)) +
  geom_point() +
  facet_wrap(vars(reign_long_cat)) +
  geom_smooth(method = "glm", 
     color = "blue",
     se = FALSE, 
     method.args = list(family = binomial))

```

## Predicting the killers

As the plots shows the "biggest" killers in the Romanian Emperor were the senate, the Praetorian Guard, the Emperor's Army and another person who wanted to be Emperor.
So whom we should be careful of?

``` {r}

model_natural <- glm(died_naturally ~ rise + century + age_reign_start + reign_long_cat, data = emperors_principate, family = "binomial")

summary(model_natural)

```

## Predicting the killer when falling by force

