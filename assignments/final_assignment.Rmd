---
title: "Final Assignment: Roman Emperors"
author: "Rebeka Zsoldos"
output: html_document
editor_options:
  chunk_output_type: console
---
## Background,

The Roman Emperors ruled the Roman Empire from 27 BC till 395 AC.

```{r setup, include=FALSE}
library(dplyr)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(viridis)
library(glmm)

theme_set(theme_light())
```

## Importing Data

```{r}
emperors_raw <- readr::read_csv(url("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-08-13/emperors.csv"), na = c("NA", "Unknown"))

```

## Cleaning Data


``` {r}
emperors_raw <- emperors_raw %>%
  mutate(
    birth_cty = as.factor(birth_cty),
    birth_prv = as.factor(birth_prv),
    #relevel the factors
    rise = fct_relevel(rise, 
                            "Seized Power", "Appointment by Army", "Appointment by Praetorian Guard", "Purchase",
                            "Election", "Appointment by Senate", "Appointment by Emperor", "Birthright"),
     #relevel the cause of death
    cause = fct_relevel(cause, 
                             "Natural Causes", "Assassination", "Execution",  "Suicide", "Died in Battle",
                              "Captivity"),
    killer = as.factor(killer),
    dynasty = as.factor(dynasty),
    era = as.factor(era)
           ) %>%
  select(-name_full, -notes, - verif_who)

emperors <- emperors_raw %>%
#As the dataset contains BC years it is necessary to recode them
#Firstly set the dates to years only
  mutate(
    birth_year = as.numeric(format(birth, '%Y')),
    death_year = as.numeric(format(death, '%Y')),
    reign_start_year = as.numeric(format(reign_start, '%Y')),
    reign_end_year = as.numeric(format(reign_end, '%Y'))) %>%
#Recode BC years as negative numbers and AC years as positive numbers
  mutate(
    birth_year = ifelse(birth_year > death_year, (birth_year * -1), (birth_year * 1)),
    reign_start_year = ifelse(reign_start_year > reign_end_year, (reign_start_year * -1), (reign_start_year * 1)),
    age_reign_start = reign_start_year - birth_year,
    age_reign_end = reign_end_year - birth_year,
#The years of the emperors' reign
    reign_long_year = reign_end_year - reign_start_year,
#Wich century did the emperor rule?
    century = reign_end_year %/% 100 + 1)
```


## The emperors

The emperors rised to and fall out of power by many reasons, so I investigate the causes how they followed each other.

``` {r}
#Putting the emperors on a timeline, based on the fact how they rose to power and which dynasty they did belong
rise_emperors <- ggplot(emperors, aes(reign_start_year, rise, color = dynasty, shape = era)) +
  geom_point(alpha = 0.5) +
  scale_x_continuous(breaks = c(-26, 305, 395),
                   labels = c("26 B.C.", "305 A.D.", "395 A.D.")) +
  xlab("The year when their ruling started") +
  ylab("The cause to rising to power") +
  labs(title = "The Rise of Emperors") +
  scale_color_viridis_d()
  
#Putting the emperors on a timeline, based on the fact how they fall out of power and which dynasty they did belong
fall_emperors <- emperors %>%
  ggplot(aes(reign_end_year, cause, color = dynasty, shape = era)) +
  geom_point(alpha = 0.5) +
  scale_x_continuous(breaks = c(14, 305, 395),
                   labels = c("14 A.D.", "305 A.D.", "395 A.D.")) +
  xlab("The year when their ruling ended") +
  ylab("The cause to fall out of power") +
  labs(title = "The Fall of Emperors") +
  scale_color_viridis_d()

rise_emperors

fall_emperors

rise_and_fall2 <- emperors %>%
  ggplot(aes(rise, fill = cause)) +
  geom_bar(width = 0.3) +
  coord_flip() +
  theme(legend.position = "bottom") +
  xlab("The rise of the emperors") +
  ylab(NULL) +
  labs(title = "The Rise and Fall of the Roman Emperors") +
  scale_fill_viridis(discrete = TRUE, na.value = "grey", name = "The cause of death")

rise_and_fall2

death_types <- emperors %>%
  count(cause, killer) %>%
  view()

died_by <- emperors %>%
  ggplot(aes(fct_rev(cause), fill = killer)) +
  geom_bar(width = 0.3) +
  coord_flip() +
  theme_light() +
  theme(legend.position = "bottom", legend.title = element_blank()) +
  xlab(NULL) +
  ylab(NULL) +
  labs(title = "The Cause of Death Among the Roman Emperors") +
  scale_fill_viridis(discrete = TRUE, na.value = "grey")


died_by

```


## The duration of the reign


``` {r}
age_and_long <- emperors %>%
  ggplot(aes(age_reign_start, reign_long_year)) +
  geom_point(alpha = 0.2, color = "red") +
  geom_text(aes(label = name), size= 3, check_overlap = TRUE) +
  geom_smooth(se = FALSE) +
  theme_light() +
  theme(legend.position = "bottom", legend.title = element_blank()) +
  xlab("The age of the emperor when rising to power") +
  ylab("Duration of the reign") +
  scale_color_viridis(discrete = TRUE, na.value = "grey")

death_and_long <- emperors %>%
  ggplot(aes(age_reign_end, reign_long_year)) +
  geom_point(alpha = 0.2, color = "red") +
  geom_text(aes(label = name), size= 3, check_overlap = TRUE) +
  geom_smooth(se = FALSE) +
  theme_light() +
  theme(legend.position = "bottom", legend.title = element_blank()) +
  xlab("The age of the emperor when his reing ended") +
  ylab("Duration of the reign") +
  scale_color_viridis(discrete = TRUE, na.value = "grey")

age_and_long
death_and_long
```


## Recoding the data and prepare it for the predictive models


```{r}

emperors_principate <- emperors %>%
#Filtering the data for the Principate era only as in the Dominate era there were 4 rulers at once
  filter(era == "Principate") %>%
  select(-birth, -death, -birth_cty, -birth_prv, -reign_start, -reign_end, -era) %>%
  mutate(
#recode cause into three categorical level
#Making one category form Captivity and Died in Battle: Battle
#Making one category from Assassination, Suicide, Execution: Forced  
    cause_recoded = recode(cause, "Died in Battle" = "Battle", "Captivity" = "Battle", "Assassination" = "Forced", "Suicide" = "Forced", "Execution" = "Forced"),
#Recoding the factor killer
#Making one category from Aneurism and Heart Failure: Health
#Making one category from Lightning, Fire: Natural disaster
    killer_recoded = recode(killer, "Aneurism" = "Health", "Heart Failure" = "Health", "Disease" = "Health",
                            "Lightning" = "Natural   Phenomenon", "Fire" = "Natural Phenomenon", "Wife" = "Other Opponents",
                            "Court Officials" = "Other Opponents", "Usurper" = "Other Opponents"),
#Making dummy variables from the cause_recoded
    died_by_force = recode(cause_recoded, "Forced" = 1, "Battle" = 0, "Natural Causes" = 0),
    died_by_battle = recode(cause_recoded, "Forced" = 0, "Battle" = 1, "Natural Causes" = 0),
    died_naturally = recode(cause_recoded, "Forced" = 0, "Battle" = 0, "Natural Causes" = 1)
    ) %>%
  dplyr:: select(index, name, rise, cause_recoded, killer_recoded, everything(), -cause, -killer, - birth_year, -death_year) %>%
#Removing missing data  
  na.omit()

```

## Probabilities of dying by force, battle, or natural causes

As the emperors have fallen by many reasons it must be interesting to find out, which factors can predict the death of emperors. 

``` {r}
#null model for modelling the predictors of dying by force
model_forced_null <- glm(died_by_force ~ 1, data = emperors_principate, family = binomial)
summary(model_forced_null)
#enter all the variables into the model
model_forced <- glm(died_by_force ~ rise + century + age_reign_start + reign_long_year, data = emperors_principate, family = binomial)
summary(model_forced)

#null model for modelling the predictors of dying in battle
model_battle_null <- glm(died_by_battle ~ 1, data = emperors_principate, family = binomial)
summary(model_battle_null)
#enter all the variables into the model
model_battle <- glm(died_by_battle ~ rise + century + age_reign_start + reign_long_year, data = emperors_principate, family = binomial)
summary(model_battle)

#null model for modelling the predictors of dying naturally
model_natural_null <- glm(died_naturally ~ 1, data = emperors_principate, family = binomial)
summary(model_natural_null)
#enter all the variables into the model
model_natural <- glm(died_naturally ~ rise + age_reign_start, data = emperors_principate, family = binomial)
summary(model_natural)
```

The AIC number of the fitted models was only higher in the case of the predictive model of dying naturally (fitted model: 52.224, null model: 55.413). This means that the variance in the case of dying in battle or by force cannot be explained by the variables in the dataset, so I will continue to work on the model related to dying naturally.

``` {r}


```
